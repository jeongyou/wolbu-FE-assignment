# 월급쟁이 부자들 강의 수강 서비스 과제

강의 목록 조회, 수강 신청, 강의 개설 기능을 제공하는 모바일 웹 기반 강의 수강 서비스입니다

---

## 프로젝트 개요

강의 서비스 특성상 **초기 진입 성능과 SEO**가 중요하다고 판단해 Next.js(App Router)를 사용했습니다.

페이지 성격에 따라 **SSR과 CSR을 분리**해 적용하고, 사용자 상호작용이 많은 영역은 클라이언트에서 유연하게 처리하도록 설계했습니다.

---

## 주요 기능
- 회원 가입
  - 가입 완료 후 로그인 절차를 순차 실행해 가입과 로그인을 한 번에 처리
  - 토큰 발급 및 저장
- 강의 목록 조회 (무한 스크롤)
- 강의 정렬 및 마감 강의 제외 필터
- 강의 선택 및 수강 신청
- 강의 개설 (강사 전용)

---

## ⚙️ 핵심 구현 사항

### 1. Server Components + SSR 적용

- 강의 목록 페이지는 **Server Component 기반 SSR**로 구현했습니다.
- 첫 화면 로딩 성능을 고려해 SSR을 적용했습니다.

---

### 2. 페이지 특성에 따른 SSR / CSR 분리

- 무한 스크롤, 정렬 변경, 필터링 등 상호작용이 많은 영역은 **Client Component**에서 처리했습니다.
- 강의 개설, 회원가입 등 나머지 페이지는 CSR로 구성해 불필요한 SSR 복잡도를 줄였습니다.
- 페이지 역할에 따라 렌더링 방식을 분리해 구조를 단순하게 유지했습니다.

---

### 3. 무한 스크롤 구조 설계

- `IntersectionObserver`를 사용해 하단 센티널이 화면에 진입하면 다음 페이지를 요청합니다.
- 스크롤 이벤트 기반 구현 대비 불필요한 이벤트 호출을 자연스럽게 방지할 수 있습니다.
- 데이터 로딩 여부를 기준으로 중복 요청을 차단해 안정적인 페이지 병합을 보장했습니다.

---

### 4. 레이아웃 구성 (Flexbox)

- 전체 레이아웃은 Flexbox 기반으로 구성했습니다.
- `AppWrapper`로 전체 컨테이너를 감싸고,
  공용 `Flex` 컴포넌트와 각 컴포넌트의 `display: flex` 스타일을 병행해
  툴바, 카드 목록, 폼 필드 정렬까지 일관된 레이아웃을 유지했습니다.

---

### 5. 인증 및 권한 관리

- 인증 및 권한 관리는 localStorage 기반으로 단순화했습니다.

---

## 추가 구현 사항

- 마감된 강의 제외 필터 제공
- id 기반 중복 강의 제거
- 수강 신청 확인 페이지
  - 수강 신청 결과(성공/실패)를 **sessionStorage**에 저장
  - 확인 페이지에서 성공/실패 강의를 구분해 사용자에게 명확히 전달

---

## 고민한 부분

### 서버 정렬 vs 클라이언트 정렬

- 불필요한 API 호출을 줄이기 위해 클라이언트 정렬도 고려했습니다.
- 하지만 무한 스크롤 특성상 전체 데이터를 보유하지 않기 때문에,
  일부 데이터만 정렬하면 새 페이지 로드 시 순서가 깨지는 문제가 발생합니다.
- 이에 따라 정렬 기준을 서버로 전달하는 **서버 정렬 방식**으로 구현했습니다.

---

## 구현 이슈 및 해결

### 하이드레이션 불일치 이슈

- 강의 개설 버튼(CreateCourseButton)은 사용자 권한(localStorage 기반)에 따라 조건부 렌더링됩니다.
- 서버 렌더링 시 사용자 정보를 알 수 없어,
  서버 HTML과 클라이언트 첫 렌더 결과가 달라지는 하이드레이션 불일치 문제가 발생했습니다.

#### 해결 방법

- 해당 버튼 컴포넌트를 CSR 전용으로 분리했습니다.
- `dynamic import`와 `ssr: false` 옵션을 적용해 클라이언트에서만 렌더링되도록 처리했습니다.

이를 통해 권한 기반 UI를 하이드레이션 오류 없이 안정적으로 제공할 수 있습니다.

---

## 테스트 코드 작성 범위

핵심 비즈니스 로직과 사용자 흐름을 중심으로 테스트 코드를 작성했습니다.

---

### 유틸 / 도메인 로직 테스트

- 비밀번호, 이메일, 휴대폰 번호 규칙 검증
- 이름 공백 제거(normalize)
- 가격 포맷(formatPrice)
- 강의명 매핑(buildCourseTitleMap)
- 강의 목록 중복 ID 제거(dedupeCoursesById)
- 수강 신청 결과 임시 저장 및 조회(enrollResultStorage)
- 강의 개설 입력값 검증
  - 제목 길이 규칙
  - 가격 최소/최대 규칙
  - 수강 인원 최소/최대 규칙

---

### 상태 / 훅 로직 테스트

- 무한 스크롤 페이지 상태 관리
  - 페이지 병합(append)
  - 첫 페이지 교체(replace)
  - 다음 페이지 존재 여부(hasMore)
- 강의 선택 상태 관리
  - 선택 토글
  - 선택 개수 계산
- 마감 강의 제외 토글 및 필터링 로직
- 무한 스크롤 데이터 로딩 흐름
  - 초기 페이지 상태 반영
  - IntersectionObserver 진입 시 다음 페이지 로드
  - 정렬 파라미터 변경 시 새로운 데이터 요청

---

### 리스트 UI 흐름 테스트 (CourseListContainer)

- 선택된 강의가 없을 때 수강 신청 버튼 비활성화
- 강의 선택 시 수강 신청 활성화 및 선택 개수 라벨 표시
- 정렬 옵션 변경 시
  - Select UI 값 변경
  - 서버 요청 파라미터(setParams)와 동기화

---

### 폼 흐름 테스트

#### 회원가입(SignUpForm)

- 필수 입력값 누락 시 에러 노출
- 비밀번호 규칙 위반 시 에러 처리
- 이메일 / 휴대폰 포맷 검증
- 기본 수강생 라디오 선택 및 변경
- 모든 입력값이 유효할 경우 제출 핸들러 호출

#### 강의 개설(CreateCourseForm)

- 필수 입력값 검증
- 제목, 가격, 수강 인원 규칙 검증
- 유효한 입력값일 경우 제출 핸들러 호출

## 폴더 구조

```text
src/
├─ api/                # 전역 API 인프라 계층
│  ├─ client/          # HTTP 클라이언트 설정, 에러/타입/URL 관리
│  ├─ useFetch.ts      # GET 요청용 공통 훅
│  └─ useMutation.ts  # POST/PUT/DELETE 요청용 공통 훅
│
├─ app/                # Next.js App Router (라우팅 및 서버 데이터 연결)
│  ├─ courses/         # 강의 관련 페이지
│  │  ├─ page.tsx      # 강의 목록 (SSR)
│  │  ├─ new/          # 강의 개설 페이지 (CSR)
│  │  └─ confirm/      # 수강 신청 결과 페이지
│  ├─ signup/          # 회원가입 페이지
│  ├─ layout.tsx       # 공통 레이아웃
│  └─ page.tsx         # 메인 페이지
│
├─ features/           # 도메인 단위 기능 모듈
│  ├─ auth/            # 인증 도메인
│  ├─ course-create/   # 강의 개설 도메인
│  ├─ courses/         # 강의 목록 / 수강 신청 도메인
│  └─ signup/          # 회원가입 도메인
│
├─ shared/             # 전역 공용 모듈
│  ├─ components/      # 재사용 UI 컴포넌트
│  ├─ guards/          # 인증/권한 접근 가드
│  ├─ hooks/           # 공용 훅
│  ├─ auth/            # 인증 스토리지 관리
│  └─ styles/          # 테마, 전역 스타일
```

### 구조 설계 의도

- **app/**
  - 라우팅과 서버 데이터 연결만 담당하는 얇은 레이어

- **features/**
  - 강의, 회원가입 등 도메인 기준으로 기능을 묶는 구조
  - 각 도메인은 `api / components / hooks / utils` 단위로 분리
  - UI 로직과 비즈니스 로직을 한 도메인 안에서 응집도 높게 관리

- **shared/**
  - 특정 도메인에 종속되지 않는 공용 자원
  - UI 컴포넌트, 접근 가드, 공용 훅, 스타일 등 재사용 대상만 포함

- **api/**
  - HTTP 통신과 관련된 공통 인프라 계층
  - API 호출 방식과 에러 처리 규칙을 중앙에서 관리

## 사용 라이브러리

- **Emotion**  
  컴포넌트 단위로 스타일을 분리하고 캡슐화하기 위해 사용했습니다.  
  `*.styles.ts` 구조로 로직과 스타일을 분리해 유지보수를 쉽게 했습니다.

- **react-hook-form**  
  폼 상태, 입력값 검증, 에러 처리를 선언적으로 관리하기 위해 사용했습니다.  
  회원가입과 강의 개설 폼에서 필드 단위 검증과 제출 제어를 간결하게 구현했습니다.

- **react-icons**  
  SVG 아이콘을 컴포넌트 형태로 사용해 UI 구성 속도를 높이기 위해 사용했습니다.

- **Vitest**  
  빠른 실행 속도의 테스트 러너로, 도메인 로직과 훅 테스트를 중심으로 사용했습니다.

- **Testing Library**  
  사용자 관점에서 UI 동작을 검증하기 위해 사용했습니다.  
  폼 입력, 버튼 활성화, 에러 노출 등 주요 사용자 흐름을 테스트했습니다.

## API 스펙 이슈

### 수강 신청 API 응답 스펙 불일치

Swagger에 정의된 수강 신청 성공 응답과 실제 응답 값이 서로 다릅니다.

#### 실제 응답

```json
{
  "enrollmentId": 1,
  "courseId": 1,
  "courseTitle": "부동산 투자 기초",
  "instructorName": "김투자",
  "userId": 1,
  "userName": "홍길동",
  "enrolledAt": "2024-01-15T14:30:00",
  "message": "수강 신청이 완료되었습니다"
}
```

#### Swagger에 등록된 응답

```json
{
  "id": 1,
  "title": "부동산 투자 기초",
  "description": "부동산 투자의 기본 개념과 전략을 배웁니다.",
  "instructorName": "김투자",
  "maxStudents": 30,
  "currentStudents": 5,
  "availableSeats": 25,
  "isFull": false,
  "price": 100000,
  "createdAt": "2025-12-29T12:01:58.573Z"
}
```

프론트엔드 구현 시 실제 응답과 첨부해주신 수강신청api.pdf 문서 기준으로 처리했습니다.
